openapi: 3.0.3
info:
  title: Dev Swarm WebUI API
  version: 0.1.0
servers:
  - url: http://localhost:8001
paths:
  /api/health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Health"
  /api/stages:
    get:
      summary: List stages
      responses:
        "200":
          description: Stage list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StageList"
  /api/stages/{stageId}/skip:
    post:
      summary: Toggle stage skip
      parameters:
        - name: stageId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/StageId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SkipRequest"
      responses:
        "200":
          description: Updated stage
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Stage"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/stages/{stageId}/run:
    post:
      summary: Start a stage run
      parameters:
        - name: stageId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/StageId"
      responses:
        "200":
          description: Run started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunStatus"
        "409":
          description: Run already active
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/stages/{stageId}/stop:
    post:
      summary: Stop a stage run
      parameters:
        - name: stageId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/StageId"
      responses:
        "200":
          description: Run stopped
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunStatus"
        "404":
          description: No active run
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/runs/{runId}:
    get:
      summary: Get run status
      parameters:
        - name: runId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/RunId"
      responses:
        "200":
          description: Run status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunStatus"
        "404":
          description: Run not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/runs/{runId}/stream:
    get:
      summary: Stream run output
      parameters:
        - name: runId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/RunId"
      responses:
        "200":
          description: SSE stream
          content:
            text/event-stream:
              schema:
                type: string
  /api/stages/{stageId}/documents:
    get:
      summary: List documents for a stage
      parameters:
        - name: stageId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/StageId"
      responses:
        "200":
          description: Document list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DocumentList"
  /api/documents:
    get:
      summary: Read a document
      parameters:
        - name: path
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Document content
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    put:
      summary: Write a document
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DocumentWrite"
      responses:
        "200":
          description: Document saved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "400":
          description: Invalid path or content
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/sync:
    post:
      summary: Sync project state
      responses:
        "200":
          description: Sync result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncResult"
components:
  schemas:
    Health:
      type: object
      properties:
        status:
          type: string
        version:
          type: string
      required: [status]
    StageId:
      type: string
      pattern: "^(0[0-9]|1[01]|99)$"
    StageStatus:
      type: string
      enum: [not-started, in-progress, completed, skipped, error]
    Stage:
      type: object
      properties:
        stageId:
          $ref: "#/components/schemas/StageId"
        name:
          type: string
        status:
          $ref: "#/components/schemas/StageStatus"
        isSkippable:
          type: boolean
        hasSkipFile:
          type: boolean
        files:
          type: array
          items:
            type: string
      required: [stageId, status]
    StageList:
      type: object
      properties:
        stages:
          type: array
          items:
            $ref: "#/components/schemas/Stage"
      required: [stages]
    SkipRequest:
      type: object
      properties:
        skip:
          type: boolean
      required: [skip]
    RunId:
      type: string
    RunStatus:
      type: object
      properties:
        runId:
          $ref: "#/components/schemas/RunId"
        stageId:
          $ref: "#/components/schemas/StageId"
        status:
          type: string
          enum: [queued, running, stopped, succeeded, failed]
        startedAt:
          type: string
          format: date-time
        endedAt:
          type: string
          format: date-time
        exitCode:
          type: integer
      required: [runId, stageId, status]
    Document:
      type: object
      properties:
        path:
          type: string
        content:
          type: string
        contentType:
          type: string
        lastModified:
          type: string
          format: date-time
      required: [path, content]
    DocumentWrite:
      type: object
      properties:
        path:
          type: string
        content:
          type: string
      required: [path, content]
    DocumentList:
      type: object
      properties:
        documents:
          type: array
          items:
            type: string
      required: [documents]
    SyncResult:
      type: object
      properties:
        syncedAt:
          type: string
          format: date-time
        stages:
          $ref: "#/components/schemas/StageList"
      required: [syncedAt, stages]
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: string
      required: [code, message]
